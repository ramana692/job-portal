<!DOCTYPE html>
<html>
<head>
    <title>API Test - Job Application</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        .output { background: #f4f4f4; padding: 15px; margin-top: 10px; border-radius: 4px; white-space: pre-wrap; }
        .error { color: red; }
        .success { color: green; }
        input { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>Job Portfolio API Test</h1>
    
    <div class="section">
        <h2>1. Test Server Connection</h2>
        <button onclick="testConnection()">Test Connection</button>
        <div id="connectionOutput" class="output"></div>
    </div>

    <div class="section">
        <h2>2. Signup</h2>
        <input type="text" id="signupName" placeholder="Name" value="Test User">
        <input type="email" id="signupEmail" placeholder="Email" value="test@example.com">
        <input type="password" id="signupPassword" placeholder="Password" value="test123">
        <input type="tel" id="signupPhone" placeholder="Phone" value="1234567890">
        <button onclick="testSignup()">Signup</button>
        <div id="signupOutput" class="output"></div>
    </div>

    <div class="section">
        <h2>3. Login</h2>
        <input type="email" id="loginEmail" placeholder="Email" value="test@example.com">
        <input type="password" id="loginPassword" placeholder="Password" value="test123">
        <button onclick="testLogin()">Login</button>
        <div id="loginOutput" class="output"></div>
    </div>

    <div class="section">
        <h2>4. Submit Job Application</h2>
        <p>Token: <span id="tokenDisplay">Not logged in</span></p>
        <button onclick="testSubmitApplication()">Submit Application</button>
        <div id="applicationOutput" class="output"></div>
    </div>

    <div class="section">
        <h2>5. Get My Applications</h2>
        <button onclick="testGetApplications()">Get Applications</button>
        <div id="getApplicationsOutput" class="output"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        let token = null;

        function log(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = isError ? 'output error' : 'output success';
        }

        async function testConnection() {
            try {
                const response = await fetch('http://localhost:5000/');
                const data = await response.json();
                log('connectionOutput', 'SUCCESS: ' + JSON.stringify(data, null, 2));
            } catch (error) {
                log('connectionOutput', 'ERROR: ' + error.message, true);
            }
        }

        async function testSignup() {
            try {
                const userData = {
                    name: document.getElementById('signupName').value,
                    email: document.getElementById('signupEmail').value,
                    password: document.getElementById('signupPassword').value,
                    phone: document.getElementById('signupPhone').value
                };

                const response = await fetch(`${API_URL}/auth/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    token = data.token;
                    document.getElementById('tokenDisplay').textContent = token.substring(0, 20) + '...';
                    log('signupOutput', 'SUCCESS: ' + JSON.stringify(data, null, 2));
                } else {
                    log('signupOutput', 'ERROR: ' + JSON.stringify(data, null, 2), true);
                }
            } catch (error) {
                log('signupOutput', 'ERROR: ' + error.message, true);
            }
        }

        async function testLogin() {
            try {
                const credentials = {
                    email: document.getElementById('loginEmail').value,
                    password: document.getElementById('loginPassword').value
                };

                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentials)
                });

                const data = await response.json();
                
                if (response.ok) {
                    token = data.token;
                    document.getElementById('tokenDisplay').textContent = token.substring(0, 20) + '...';
                    log('loginOutput', 'SUCCESS: ' + JSON.stringify(data, null, 2));
                } else {
                    log('loginOutput', 'ERROR: ' + JSON.stringify(data, null, 2), true);
                }
            } catch (error) {
                log('loginOutput', 'ERROR: ' + error.message, true);
            }
        }

        async function testSubmitApplication() {
            if (!token) {
                log('applicationOutput', 'ERROR: Please login first!', true);
                return;
            }

            try {
                const applicationData = {
                    jobTitle: "Software Developer",
                    company: "Test Company Ltd",
                    applicantName: "Test User",
                    email: "test@example.com",
                    phone: "1234567890",
                    coverLetter: "I am very interested in this position...",
                    resume: "resume.pdf"
                };

                console.log('Sending application:', applicationData);
                console.log('With token:', token);

                const response = await fetch(`${API_URL}/applications`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(applicationData)
                });

                const data = await response.json();
                
                if (response.ok) {
                    log('applicationOutput', 'SUCCESS! Application saved to MongoDB:\n' + JSON.stringify(data, null, 2));
                } else {
                    log('applicationOutput', 'ERROR: ' + JSON.stringify(data, null, 2), true);
                }
            } catch (error) {
                log('applicationOutput', 'ERROR: ' + error.message, true);
            }
        }

        async function testGetApplications() {
            if (!token) {
                log('getApplicationsOutput', 'ERROR: Please login first!', true);
                return;
            }

            try {
                const response = await fetch(`${API_URL}/applications`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    log('getApplicationsOutput', 'SUCCESS:\n' + JSON.stringify(data, null, 2));
                } else {
                    log('getApplicationsOutput', 'ERROR: ' + JSON.stringify(data, null, 2), true);
                }
            } catch (error) {
                log('getApplicationsOutput', 'ERROR: ' + error.message, true);
            }
        }
    </script>
</body>
</html>
